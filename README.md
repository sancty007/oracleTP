# oracleTP

Pour représenter le schéma de la base de données, voici une version textuelle détaillée des tables et de leurs relations. Ce schéma est une représentation structurée des tables, de leurs colonnes et des clés primaires et étrangères.

### Schéma de la Base de Données

#### 1. REGIONS TABLE

```sql
CREATE TABLE REGIONS (
    REGION_ID INT PRIMARY KEY,
    REGION_NAME VARCHAR2(40) NOT NULL
);
```

#### 2. COUNTRIES TABLE

```sql
CREATE TABLE COUNTRIES (
    COUNTRY_ID CHAR(2) NOT NULL PRIMARY KEY,
    COUNTRY_NAME VARCHAR2(40),
    REGION_ID NUMBER,
    CONSTRAINT COUNTRIES_FK1 FOREIGN KEY (REGION_ID) REFERENCES REGIONS (REGION_ID)
);
```

#### 3. LOCATIONS TABLE

```sql
CREATE TABLE LOCATIONS (
    LOCATION_ID INT PRIMARY KEY,
    STREET_ADDRESS VARCHAR2(100),
    POSTAL_CODE VARCHAR2(20),
    CITY VARCHAR2(50) NOT NULL,
    STATE_PROVINCE VARCHAR2(50),
    COUNTRY_ID CHAR(2),
    CONSTRAINT LOCATIONS_FK1 FOREIGN KEY (COUNTRY_ID) REFERENCES COUNTRIES (COUNTRY_ID)
);
```

#### 4. DEPARTMENTS TABLE

```sql
CREATE TABLE DEPARTMENTS (
    DEPARTMENT_ID INT PRIMARY KEY,
    DEPARTMENT_NAME VARCHAR2(50) NOT NULL,
    MANAGER_ID INT,
    LOCATION_ID INT,
    CONSTRAINT DEPARTMENTS_FK1 FOREIGN KEY (MANAGER_ID) REFERENCES EMPLOYEES (EMPLOYEE_ID),
    CONSTRAINT DEPARTMENTS_FK2 FOREIGN KEY (LOCATION_ID) REFERENCES LOCATIONS (LOCATION_ID)
);
```

#### 5. JOBS TABLE

```sql
CREATE TABLE JOBS (
    JOB_ID VARCHAR2(10) PRIMARY KEY,
    JOB_TITLE VARCHAR2(50) NOT NULL,
    MIN_SALARY NUMBER,
    MAX_SALARY NUMBER
);
```

#### 6. EMPLOYEES TABLE

```sql
CREATE TABLE EMPLOYEES (
    EMPLOYEE_ID INT PRIMARY KEY,
    FIRST_NAME VARCHAR2(50),
    LAST_NAME VARCHAR2(50) NOT NULL,
    EMAIL VARCHAR2(100) NOT NULL UNIQUE,
    PHONE_NUMBER VARCHAR2(20),
    HIRE_DATE DATE NOT NULL,
    JOB_ID VARCHAR2(10),
    SALARY NUMBER NOT NULL,
    COMMISSION_PCT NUMBER,
    MANAGER_ID INT,
    DEPARTMENT_ID INT,
    CONSTRAINT EMPLOYEES_FK1 FOREIGN KEY (JOB_ID) REFERENCES JOBS (JOB_ID),
    CONSTRAINT EMPLOYEES_FK2 FOREIGN KEY (MANAGER_ID) REFERENCES EMPLOYEES (EMPLOYEE_ID),
    CONSTRAINT EMPLOYEES_FK3 FOREIGN KEY (DEPARTMENT_ID) REFERENCES DEPARTMENTS (DEPARTMENT_ID)
);
```

#### 7. JOB_HISTORY TABLE

```sql
CREATE TABLE JOB_HISTORY (
    EMPLOYEE_ID INT,
    START_DATE DATE,
    END_DATE DATE NOT NULL,
    JOB_ID VARCHAR2(10) NOT NULL,
    DEPARTMENT_ID INT NOT NULL,
    PRIMARY KEY (EMPLOYEE_ID, START_DATE),
    CONSTRAINT JOB_HISTORY_FK1 FOREIGN KEY (EMPLOYEE_ID) REFERENCES EMPLOYEES (EMPLOYEE_ID),
    CONSTRAINT JOB_HISTORY_FK2 FOREIGN KEY (JOB_ID) REFERENCES JOBS (JOB_ID),
    CONSTRAINT JOB_HISTORY_FK3 FOREIGN KEY (DEPARTMENT_ID) REFERENCES DEPARTMENTS (DEPARTMENT_ID)
);
```

### Vue EMP_DETAILS_VIEW

La vue `EMP_DETAILS_VIEW` rassemble des informations détaillées sur les employés à partir de plusieurs tables liées :

```sql
CREATE VIEW EMP_DETAILS_VIEW AS
SELECT 
    e.EMPLOYEE_ID,
    e.FIRST_NAME,
    e.LAST_NAME,
    e.EMAIL,
    e.PHONE_NUMBER,
    e.HIRE_DATE,
    j.JOB_TITLE,
    e.SALARY,
    e.COMMISSION_PCT,
    m.FIRST_NAME AS MANAGER_FIRST_NAME,
    m.LAST_NAME AS MANAGER_LAST_NAME,
    d.DEPARTMENT_NAME,
    l.STREET_ADDRESS,
    l.POSTAL_CODE,
    l.CITY,
    l.STATE_PROVINCE,
    c.COUNTRY_NAME,
    r.REGION_NAME
FROM EMPLOYEES e
JOIN JOBS j ON e.JOB_ID = j.JOB_ID
JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
JOIN LOCATIONS l ON d.LOCATION_ID = l.LOCATION_ID
JOIN COUNTRIES c ON l.COUNTRY_ID = c.COUNTRY_ID
JOIN REGIONS r ON c.REGION_ID = r.REGION_ID
LEFT JOIN EMPLOYEES m ON e.MANAGER_ID = m.EMPLOYEE_ID;
```

### Diagramme Entité-Relation (ERD)

Pour mieux visualiser, voici une représentation textuelle des relations entre les tables :

```
(REGION) 1---N (COUNTRY)
           |
           N
       (LOCATION) 1---N (DEPARTMENT)
                        |
                        N
                   (EMPLOYEE) 1---N (JOB_HISTORY)
                        |           |
                        N           N
                     (JOB)        (DEPARTMENT)
```

- **REGION** a plusieurs **COUNTRY**
- **COUNTRY** a plusieurs **LOCATION**
- **LOCATION** a plusieurs **DEPARTMENT**
- **DEPARTMENT** a plusieurs **EMPLOYEE**
- **EMPLOYEE** a plusieurs **JOB_HISTORY**
- **JOB** a plusieurs **EMPLOYEE**
- **JOB** a plusieurs **JOB_HISTORY**
- **DEPARTMENT** a plusieurs **JOB_HISTORY**
- **EMPLOYEE** peut avoir un **MANAGER** qui est aussi un **EMPLOYEE**

Ce schéma décrit comment les différentes entités sont interconnectées dans la base de données.
